# Define the main directory for Apache
ServerRoot "/usr/local/apache2"

# Listen for incoming connections on ports 80 (HTTP) and 443 (HTTPS)
Listen 80
Listen 443

# Define the server name (used in virtual hosts)
ServerName localhost

# Set the user and group under which Apache will run
User apache
Group apache

# SSL & Security Modules
# These modules handle SSL/TLS encryption, caching, and security enforcement.
LoadModule ssl_module modules/mod_ssl.so
LoadModule socache_shmcb_module modules/mod_socache_shmcb.so
LoadModule security2_module modules/mod_security2.so
LoadModule headers_module modules/mod_headers.so
LoadModule filter_module modules/mod_filter.so
LoadModule deflate_module modules/mod_deflate.so
LoadModule reqtimeout_module modules/mod_reqtimeout.so

# Core Apache Functionality Modules
# These modules provide essential functions for Apache to run properly.
LoadModule unixd_module modules/mod_unixd.so
LoadModule unique_id_module modules/mod_unique_id.so

# Authentication & Authorization Modules
# These modules control access permissions and authentication.
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule authz_host_module modules/mod_authz_host.so
LoadModule auth_digest_module modules/mod_auth_digest.so

# Proxy & WebSockets Modules
# These modules enable Apache to act as a reverse proxy and handle WebSocket connections.
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so

# Logging & Monitoring Modules
# These modules provide logging capabilities for debugging and access monitoring.
LoadModule log_config_module modules/mod_log_config.so
LoadModule logio_module modules/mod_logio.so
LoadModule status_module modules/mod_status.so

# Performance Optimization Modules
# These modules improve performance and scalability for concurrent connections.
LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule expires_module modules/mod_expires.so

# URL Rewriting & Redirection Modules
# This module allows rewriting and redirection of URLs.
LoadModule rewrite_module modules/mod_rewrite.so

# Enable ModSecurity rules if the module is loaded
<IfModule security2_module>
    SecRuleEngine On
</IfModule>

# Configure SSL session caching to improve performance
SSLSessionCache shmcb:/usr/local/apache2/logs/ssl_scache(512000)
SSLSessionCacheTimeout 300


# Define supported SSL/TLS protocols and ciphers
SSLProtocol all -SSLv3 -TLSv1 -TLSv1.1
SSLHonorCipherOrder On
SSLCipherSuite HIGH:!aNULL:!MD5:!3DES:!CAMELLIA:!RC4

# Set OpenSSL security settings for better encryption
SSLOpenSSLConfCmd CipherSuites TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256
SSLOpenSSLConfCmd ECDHParameters secp384r1
SSLOpenSSLConfCmd Curves secp384r1

# Disable SSL session tickets (reduces risk of session hijacking)
SSLSessionTickets Off

# Configure OCSP stapling (reduces SSL handshake time)
SSLStaplingResponderTimeout 5
SSLStaplingReturnResponderErrors off

# Include additional configuration files
Include conf/extra/httpd-vhosts.conf
Include conf/modsecurity.conf

# Configure logging
ErrorLog "/dev/stderr"
CustomLog "/dev/stdout" combined
